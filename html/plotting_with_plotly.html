<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>pyodide-cheat-sheet: Plotting with plotly</title>
	<script src="https://cdn.jsdelivr.net/pyodide/v0.28.2/full/pyodide.js"></script>
    <script src="https://cdn.plot.ly/plotly-3.1.0.min.js" charset="utf-8"></script>
  </head>
  <body>
    <p><a href=".">Back to index</a></p>
    <h1>Plotting with plotly</h1>
    <div id="plotTarget"></div>
    <script>
      const pyodidePromise = startPyodide();

      async function startPyodide() {
        const pyodide = await loadPyodide();

        await pyodide.loadPackage("micropip");
        const micropip = pyodide.pyimport("micropip");
        await micropip.install(["plotly", "pandas"]);

        pyodide.runPython(`
          from js import document
          import plotly.express as px

          def plot(target):
            plot_output = document.getElementById(target)

            fig = px.bar(x=["a", "b", "c"], y=[1, 3, 2])
            fig_html = fig.to_html(
              include_plotlyjs=False,
              full_html=False,
              default_height='350px',
            )
            render_plot(plot_output, fig_html)

          #  from https://codepen.io/jmsmdy/pen/MWpdjVZ
          def render_plot(container, plot_html):
            range = document.createRange()
            range.selectNode(container)
            document_fragment = range.createContextualFragment(plot_html)
            while container.hasChildNodes():
              container.removeChild(container.firstChild)
            container.appendChild(document_fragment)
            container.style = "width: 100%; height: 350px; overflow-y: scroll;"
        `);

        return pyodide;
      }

      async function plot() {
        (await pyodidePromise).runPython("plot")("plotTarget");
      }
      plot();
    </script>
  </body>
</html>
